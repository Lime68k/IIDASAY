<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>INTERNET IS DYING AND SO ARE YOU</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,200..900;1,200..900&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: "Source Code Pro", monospace;
      font-weight: 400;
      text-align: center;
      padding: 50px;
      background: #fdf0f5;
    }
    audio {
      width: 300px;
    }
    #cover {
      max-width: 300px;
      margin: 20px auto;
      display: block;
      border-radius: 10px;
    }
  </style>
</head>
<body>
  <h1>INTERNET IS DYING AND SO ARE YOU</h1>
  <h3>currently curated by <a href="https://n2v2.bandcamp.com" target="_blank">névé</a>, <a href="https://thanas1.bandcamp.com" target="_blank">louisæ</a>, <a href="https://score16.bandcamp.com" target="_blank">score16</a> and <a href="https://mathildab.bandcamp.com" target="_blank">mathilda b</a></h3>
  
  <!-- Le lecteur audio -->
  <audio controls preload="none" style="margin: 25px">
    <source src="https://radio.spaceghost.pink/idasay.mp3" type="audio/mpeg">
    HTML5 audio not supported by your browser.
  </audio>
  
  <!-- Titre -->
  <p id="current-title">Loading...</p>

  <!-- Cover -->
  <a id="cover-link" href="#" target="_blank" style="display:none;">
    <img id="cover" src="" alt="Current cover">
  </a>
  
  <p id="current-listeners">Loading listeners...</p>

  <p style="text-align: left; white-space: pre; margin-top: 150px;">This page is under construction, any help is welcome!</p> 
  <p style="text-align: left; white-space: pre; margin-top: 100px;"> 　　　　  /￣＞￣￣フ Idasay triste car no croquettes......
 　　　　　| 　_　 _l  
 　 　　　／` ミ＿xノ 
　　 　  / 　　   |        QU'ON LUI SERVE SES CROQUETTES ET VITE! 
　　 　 /  ヽ  　 ﾉ 
 　 　 /　　|　|　| 
 　／￣|    |　|　|    
　| (￣ヽ＿__ヽ_)__)     \＿＿/ <-- bol vide!! (╬ Ò﹏Ó)
 　＼二つ</p>

<script>
  // Fonction pour convertir les entités Unicode en caractères
  function decodeUnicodeEntities(str) {
    return str.replace(/&#(\d+);/g, (_, code) => String.fromCodePoint(code));
  }

  async function updateInfo() {
    try {
      // --- Récup infos titre et listeners ---
      const statusRes = await fetch("https://radio.spaceghost.pink/status-json.xsl");
      const statusData = await statusRes.json();
      const source = statusData.icestats.source;

      // récup titre
      let title = source.title || "No title";
      title = decodeUnicodeEntities(title);

      // récup listeners
      let listeners = source.listeners ?? 0;
      document.getElementById("current-listeners").innerHTML =
        `${listeners} listener${listeners !== 1 ? "s <a href='https://web.libera.chat/?channels=#idasay' target='_blank'>Maybe you’d like to chat all together?</a>" : ""}`;

      // --- Récup infos nowplaying (url + cover) ---
      const nowRes = await fetch("https://radio.spaceghost.pink/np/nowplaying.json");
      const nowData = await nowRes.json();

      const trackUrl = nowData.url || "#";
      const coverUrl = nowData.cover || "";

      // maj du titre cliquable
      const titleEl = document.getElementById("current-title");
      titleEl.innerHTML = `<a href="${trackUrl}" target="_blank">♫ ${title} ♫</a>`;

      // maj de la cover
      const coverImg = document.getElementById("cover");
      const coverLink = document.getElementById("cover-link");
      if (coverUrl) {
        coverImg.src = coverUrl + "?t=" + new Date().getTime();
        coverLink.href = trackUrl;
        coverLink.style.display = "inline-block";
      } else {
        coverLink.style.display = "none";
      }

    } catch (error) {
      console.error("Erreur :", error);
      document.getElementById("current-title").textContent = "Impossible to fetch title";
      document.getElementById("current-listeners").textContent = "Impossible to fetch listeners";
    }
  }

  // premier appel
  updateInfo();

  // refresh toutes les 10s
  setInterval(updateInfo, 10000);
</script>

</body>
</html>
