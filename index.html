<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>INTERNET IS DYING AND SO ARE YOU</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,200..900;1,200..900&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: "Source Code Pro", monospace;
      font-optical-sizing: auto;
      font-weight: 400;
      font-style: normal;
      text-align: center;
      padding: 50px;
      background: #fdf0f5;
    }
    audio {
      width: 300px;
    }
  </style>
</head>
<body>
  <h1>INTERNET IS DYING AND SO ARE YOU</h1>
  <h3>currently curated by <a href="https://n2v2.bandcamp.com" target="_blank">névé</a>, <a href="https://thanas1.bandcamp.com" target="_blank">louisæ</a> and <a href="https://score16.bandcamp.com" target="_blank">score16</a></h3>
  
  <!-- Le lecteur audio -->
  <audio controls preload="none" style="margin: 50px">
    <source src="https://radio.spaceghost.pink/idasay.mp3" type="audio/mpeg">
    HTML5 audio not supported by your browser.
  </audio>

  <p id="current-title">Loading...</p>
  <p id="current-listeners">Loading listeners...</p>

  <p style="text-align: left; white-space: pre; margin-top: 150px;">This page is under construction, any help is welcome!</p> 
  <p style="text-align: left; white-space: pre; margin-top: 100px;"> 　　　　  /￣＞￣￣フ Idasay triste car no croquettes......
 　　　　　| 　_　 _l  
 　 　　　／` ミ＿xノ 
　　 　  / 　　   |        QUON LUI SERVE CES CROQUETTES ET VITE! 
　　 　 /  ヽ  　 ﾉ 
 　 　 /　　|　|　| 
 　／￣|    |　|　|    
　| (￣ヽ＿__ヽ_)__)     \＿＿/ <-- bol vide!! (╬ Ò﹏Ó)
 　＼二つ</p>

<script>
  // Fonction pour convertir les entités Unicode en caractères
  function decodeUnicodeEntities(str) {
    return str.replace(/&#(\d+);/g, (_, code) => String.fromCodePoint(code));
  }

  // Fonction pour récupérer le titre et le nombre de listeners
  function updateInfo() {
    fetch("https://radio.spaceghost.pink/status-json.xsl")
      .then(response => response.json())
      .then(data => {
        const source = data.icestats.source;

        // récup titre
        let title = source.title || "No title";
        title = decodeUnicodeEntities(title);
        document.getElementById("current-title").textContent = `♫ ${title} ♫`;

        // récup listeners
        let listeners = source.listeners ?? 0;
        document.getElementById("current-listeners").innerHTML = `${listeners} listener${listeners !== 1 ? "s <a href='https://web.libera.chat/?channels=#idasay' target='_blank'>Maybe you’d like to chat all together?</a>" : ""}`;

      })
      .catch(error => {
        console.error("Erreur :", error);
        document.getElementById("current-title").textContent = "Impossible to fetch title";
        document.getElementById("current-listeners").textContent = "Impossible to fetch listeners";
      });
  }

  // premier appel
  updateInfo();

  // refresh toutes les 10s
  setInterval(updateInfo, 10000);
</script>

</body>
</html>
