<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Lecteur Icecast</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 50px;
      background: #fdf0f5;
    }
    audio {
      width: 300px;
    }
  </style>
</head>
<body>
  <h1>INTERNET IS DYING AND SO ARE YOU</h1>
  <h3>currently curated by <a href="https://n2v2.bandcamp.com">névé</a>, <a href="https://thanas1.bandcamp.com">louisæ</a> and <a href="https://score16.bandcamp.com">score16</a></h3>
  
  <!-- Le lecteur audio -->
  <audio controls preload="none">
    <source src="https://radio.spaceghost.pink/idasay.mp3" type="audio/mpeg">
    Ton navigateur ne supporte pas l’audio HTML5.
  </audio>

  <p id="current-title">Loading...</p>

<script>
  // Fonction pour convertir les entités Unicode en caractères
  function decodeUnicodeEntities(str) {
    return str.replace(/&#(\d+);/g, (_, code) => String.fromCodePoint(code));
  }

  // Fonction pour récupérer le titre et l'afficher
  function updateTitle() {
    fetch("https://radio.spaceghost.pink/status-json.xsl")
      .then(response => response.json())
      .then(data => {
        // on récupère le titre
        let title = data.icestats.source.title;

        // on décode les entités Unicode
        title = decodeUnicodeEntities(title);

        // on affiche le titre
        document.getElementById("current-title").textContent = `♫ ${title} ♫`;
      })
      .catch(error => {
        console.error("Erreur :", error);
        document.getElementById("current-title").textContent = "Impossible to fetch title";
      });
  }

  // On appelle la fonction une première fois au chargement
  updateTitle();

  // Puis on la relance toutes les 10 secondes
  setInterval(updateTitle, 10000);
</script>

</body>
</html>
